local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local isRunning = false
local targetMutation = "Albino"  -- Mutation ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
local hotbarSlot = 9
local firstYes = true

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏≤ TextButton ‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
local function findButton(text)
    for _, gui in ipairs(PlayerGui:GetDescendants()) do
        if gui:IsA("TextButton") and string.find(gui.Text, text) then
            return gui
        end
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
local function clickButton(btn)
    if btn and btn:IsA("TextButton") then
        game:GetService("VirtualInputManager"):SendMouseButtonEvent(0,0,0,true,btn,0)
        task.wait(0.1)
        game:GetService("VirtualInputManager"):SendMouseButtonEvent(0,0,0,false,btn,0)
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏¢‡∏¥‡∏ö slot
local function equipSlot(slot)
    local backpack = LocalPlayer.Backpack
    local char = LocalPlayer.Character
    if not char then return end
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    if humanoid then
        local tool = backpack:FindFirstChildWhichIsA("Tool")
        if tool then
            humanoid:EquipTool(tool)
            task.wait(0.2)
        end
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
local function resetAll()
    isRunning = false
    firstYes = true
    if ToggleBtn then
        ToggleBtn.Text = "Start"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(80,180,60)
    end
    print("üîÑ Reset Complete: Ready for next run")
end

-- ‡∏•‡∏π‡∏õ Auto Appraise
local function autoAppraise()
    task.spawn(function()
        while isRunning do
            task.wait(0.6)

            -- ‡∏ñ‡∏∑‡∏≠ slot 9
            equipSlot(hotbarSlot)

            if firstYes then
                local appraiseBtn = findButton("Can you appraise this fish?")
                if appraiseBtn then clickButton(appraiseBtn) task.wait(0.5) end

                local yesBtn = findButton("Yes")
                if yesBtn then
                    clickButton(yesBtn)
                    firstYes = false
                    task.wait(1.2)
                end
            else
                local appraiseBtn = findButton("Can you appraise this fish?")
                if appraiseBtn then clickButton(appraiseBtn) task.wait(1.2) end
            end

            -- ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö Mutation ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
            for _, gui in ipairs(PlayerGui:GetDescendants()) do
                if gui:IsA("TextLabel") and string.find(string.lower(gui.Text), string.lower(targetMutation)) then
                    warn("üéâ Found Mutation:", targetMutation)
                    resetAll()  -- ‡∏´‡∏¢‡∏∏‡∏î + ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    return
                end
            end
        end
    end)
end

-- Detect ‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö NPC ‡πÅ‡∏•‡πâ‡∏ß
PlayerGui.DescendantAdded:Connect(function(obj)
    if not isRunning and obj:IsA("TextLabel") and string.find(obj.Text, "Can you appraise this fish?") then
        if not isRunning then
            print("‚ñ∂Ô∏è Auto Appraise Started")
            isRunning = true
            firstYes = true
            autoAppraise()
        end
    end
end)

-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏≠‡∏á
ToggleBtn.MouseButton1Click:Connect(function()
    if isRunning then
        print("‚õî Stopped by User")
        resetAll()
    else
        print("‚úÖ Ready: Press E to talk NPC")
        isRunning = false
        firstYes = true
        ToggleBtn.Text = "Stop"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(220,80,40)
    end
end)
