-- 🟢 Auto Appraise Until Target Mutation (Hotbar Slot 9)
local TARGET_MUTATION = "Golden"  -- <<< เปลี่ยนตรงนี้เป็น mutation ที่ต้องการ
local HOTBAR_SLOT = 9            -- <<< ต้องถือปลาไว้ในช่องนี้

local player = game.Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")
local UIS = game:GetService("UserInputService")

-- ฟังก์ชันหาปุ่ม
local function findButton(text)
    for _, gui in ipairs(PlayerGui:GetDescendants()) do
        if gui:IsA("TextButton") or gui:IsA("ImageButton") then
            if string.find(string.lower(gui.Text), string.lower(text)) then
                return gui
            end
        end
    end
    return nil
end

-- ฟังก์ชันกดปุ่ม
local function clickButton(btn)
    if btn then
        task.wait(0.2)
        firesignal(btn.MouseButton1Click)
        print("✅ Click:", btn.Text)
        return true
    end
    return false
end

-- ฟังก์ชันเปลี่ยนไปถือไอเท็มที่ช่อง 9
local function equipSlot(slot)
    local hotkey = Enum.KeyCode["One"].Value + (slot - 1) -- One=49, Two=50...
    local key = Enum.KeyCode[({ "One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Zero" })[slot]]
    if key then
        UIS.InputBegan:Fire(key, false) -- จำลองกดปุ่มเลข
    end
end

-- ฟังก์ชันหลัก
local function autoAppraise()
    task.spawn(function()
        local firstYes = true
        while true do
            task.wait(0.6)

            -- ตรวจว่าถือปลาในช่อง 9 ไว้รึยัง
            equipSlot(HOTBAR_SLOT)

            -- รอบแรกต้องกด Yes ด้วย
            if firstYes then
                local appraiseBtn = findButton("Can you appraise this fish?")
                if appraiseBtn then
                    clickButton(appraiseBtn)
                    task.wait(0.5)
                end

                local yesBtn = findButton("Yes")
                if yesBtn then
                    clickButton(yesBtn)
                    firstYes = false -- หลังจากนี้ไม่ต้องกด Yes แล้ว
                    task.wait(1.5)
                end
            else
                -- รอบถัดไปกดแต่ "Can you appraise this fish?" อย่างเดียว
                local appraiseBtn = findButton("Can you appraise this fish?")
                if appraiseBtn then
                    clickButton(appraiseBtn)
                    task.wait(1.5)
                end
            end

            -- ตรวจว่าเจอ mutation ตามต้องการหรือยัง
            for _, gui in ipairs(PlayerGui:GetDescendants()) do
                if gui:IsA("TextLabel") and string.find(string.lower(gui.Text), string.lower(TARGET_MUTATION)) then
                    print("🎉 เจอ Mutation:", TARGET_MUTATION)
                    return -- หยุด loop
                end
            end
        end
    end)
end

-- เริ่มทำงานออโต้เมื่อ UI สนทนาเด้งขึ้น
PlayerGui.ChildAdded:Connect(function(child)
    task.wait(0.3)
    if string.find(string.lower(child.Name), "dialogue") or string.find(string.lower(child.Name), "options") then
        print("📌 เริ่มคุยกับ NPC → Auto Appraise")
        autoAppraise()
    end
end)
